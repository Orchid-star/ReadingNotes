# 第18章 用于大型程序的工具

大规模应用程序的特殊要求：

- 子系统之间协同处理错误的能力（异常处理）
- 各种库协同开发的能力（命名空间）
- 复杂应用概念建模（多重继承）



## 18.1 异常处理

**异常处理**：一种机制，允许程序中独立开发的部分能够在运行时就出现的问题进行通信并做相应的处理。异常使程序员能够将问题的检测与解决过程分离。

有效地使用异常处理，包括：抛出异常发生什么，捕获异常发生了什么，以及传递错误的对象的意义。

### 18.1.1 抛出异常

C++通过抛出一条表达式引发异常。

被抛出的表达式的类型以及当前的调用链共同决定使用哪一段处理代码来处理该异常。被选中的代码是调用链中与抛出的对象类型匹配最接近的代码。抛出的对象的类型和内容，告知异常处理部分发生了哪一类型的错误。

执行throw时，throw后的语句不再执行（类似return），程序的控制权从throw转移到与之匹配的catch模块：

- 沿着调用链的函数可能会提早退出
- 一旦程序开始执行异常处理代码，则沿着调用链创建的对象将被销毁

当找不到匹配的catch时，程序将调用标准库函数terminate终止当前的程序。

匹配catch的过程称为**栈展开**。

栈展开过程中对象被自动销毁。

**析构函数与异常**：

负责释放资源的代码前发生异常将导致释放资源的代码不会执行。类对象分配的资源将由类的析构函数负责释放。因此，使用类来控制资源的分配能够确保无论函数正常结束还是遭遇异常，资源都能被正确地释放。

类的析构函数不应该抛出不能被它自身处理的异常。所有的标准库设施都能够确保它们的析构函数不会引发异常。