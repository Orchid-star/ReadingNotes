**程序员希望用段，物理内存希望用页，如何处理？**

使用虚拟内存，进行段页结合



**段页同时存在：段面向用户、页面向硬件**

<img src="./images/虚拟内存.png" style="zoom:67%;" />

逻辑地址依旧是段地址+偏移地址（CS:IP）。在虚拟的地址空间内为程序的各个段分配完整的空间，记录在段表内。同时建立页表，完成虚拟地址对物理内存的映射。



**程序载入内存**

1. 从虚拟地址空间分配一段内存（称虚存）给程序段，建立段表

<img src="./images/程序载入内存.png" style="zoom:67%;" />

nr是进程序号，p是PCB，ldt[1]和ldt[2]分别段页代码段、数据段。所以这一段代码完成的是*分配虚存、建段表*。

这个地方做了简化，每个进程分配了64M的虚拟地址空间，*互不重叠*，这样可以使所有的虚拟地址共用一套页表，每一个虚拟地址对应该页表中的不同页。

2.为虚拟地址分配内存、建页表（将虚拟地址与物理内存进行映射）



